[{"id":"627ba918.fbd268","type":"tab","label":"Flow 1","disabled":false,"info":""},{"id":"f4811132.b4e7b","type":"http request","z":"627ba918.fbd268","name":"Send Request to Harvest Records","method":"GET","ret":"obj","url":"","tls":"","x":500,"y":700,"wires":[["1fdb807b.4e808"]]},{"id":"6f4e8a2b.50a194","type":"change","z":"627ba918.fbd268","name":"","rules":[{"t":"set","p":"url","pt":"msg","to":"config.url","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":230,"y":700,"wires":[["f4811132.b4e7b"]]},{"id":"1fdb807b.4e808","type":"function","z":"627ba918.fbd268","name":"Select Items","func":"items = msg.payload.message.items;\nmsg.payload = items;\nreturn msg;","outputs":1,"noerr":0,"x":770,"y":700,"wires":[["24bcef28.0f7c1"]]},{"id":"b0d5e018.1747f","type":"inject","z":"627ba918.fbd268","name":"","topic":"","payload":"CrossRef Harvest","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":140,"y":580,"wires":[["90f48300.8f93b"]]},{"id":"24bcef28.0f7c1","type":"splitter","z":"627ba918.fbd268","name":"","property":"payload","x":110,"y":780,"wires":[["9c027bd7.a3b2f8","63024f88.0bce6","e23181ef.db8aa"]]},{"id":"90f48300.8f93b","type":"file in","z":"627ba918.fbd268","name":"crossref-workMapping.yaml","filename":"projects/share-red-flows/harvest-flows/crossref-workMapping.yaml","format":"utf8","chunk":false,"sendError":false,"x":400,"y":600,"wires":[["f8b39638.612fa8"]]},{"id":"f8b39638.612fa8","type":"yaml","z":"627ba918.fbd268","property":"payload","name":"crossref","x":640,"y":600,"wires":[["7ff78a54.bfb394"]]},{"id":"7ff78a54.bfb394","type":"function","z":"627ba918.fbd268","name":"SetMappingConfig","func":"global.set(\"config\",msg.payload);\n//msg.shareMapping = msg.payload.shareMapping;\n//shareMapping = msg.payload.shareMapping || false;\n//context.smoke = context.smoke || false;\n//flow.shareMapping = shareMapping;\n\n//if (shareMapping) {\n//  flow.mapping = shareMapping;\n//  return msg;\n//} //else if (msg.topic === 'tempSensor') {\n  //context.temp = msg.payload;\n//}\nconsole.log(\"Using shareMapping config: \"+global.get(\"shareMapping\"));\nreturn msg;\n//return null;\n//config = msg.payload;\n//global.set(\"shareMapping.givenName\",config.givenName);\n//global.set(\"shareMapping.familyName\",config.familyName);\n//global.set(\"title\",config.title);\n//msg.payload = global.get(\"title\");\n//return msg;","outputs":1,"noerr":0,"x":850,"y":600,"wires":[["6f4e8a2b.50a194"]]},{"id":"9c027bd7.a3b2f8","type":"function","z":"627ba918.fbd268","name":"GetCreators","func":"config = global.get(\"config\");\nshareMapping = config.shareMapping;\n//shareMapping = global.get(\"shareMapping\");\n\nin_work = msg.payload;\nout_work = {};\nout_work.creators = [];\nvar given = shareMapping.givenName;\nvar family = shareMapping.familyName;\n//need to add logic to handle more than one split\nvar givenPropArr = given.split(\".\");\nvar familyPropArr = family.split(\".\");\nif (givenPropArr.length>0){\n    in_creators = in_work[givenPropArr[0]];\n    if (in_creators){\n        for (var i = 0; i < in_creators.length; i++){\n            in_creator = in_creators[i];\n            creator = {};\n            creator.givenName = in_creator[givenPropArr[1]];\n            creator.familyName = in_creator[familyPropArr[1]];\n            out_work.creators.push(creator);\n        \n        }\n    }\n}\n\nmsg.payload = out_work;\nreturn msg;\n","outputs":1,"noerr":0,"x":290,"y":840,"wires":[["1e6d1c31.1e6cf4"]]},{"id":"63024f88.0bce6","type":"function","z":"627ba918.fbd268","name":"GetTitles","func":"config = global.get(\"config\");\nshareMapping = config.shareMapping;\n\nin_work = msg.payload;\nout_work = {};\nout_work.titles = [];\n\nvar titleProp = shareMapping.title;\n//need to add logic to handle more than one split\n//var titlePropArr = titleProp.split(\".\");\n//if (titlePropArr.length>0){\n    in_titles = in_work[titleProp];\n    //need to handle if not an array\n    if (in_titles){\n        for (var i = 0; i < in_titles.length; i++){\n            in_title = in_titles[i];\n            title = {};\n            title = in_title;\n            out_work.titles.push(title);\n        }\n    }\n//}\n\nmsg.payload = out_work;\nreturn msg;","outputs":1,"noerr":0,"x":280,"y":900,"wires":[["269eb26b.f6f0ae"]]},{"id":"f8ae5763.309b88","type":"wait-paths","z":"627ba918.fbd268","name":"","paths":"[\"in_work\",\"creators\",\"titles\"]","timeout":15000,"finalTimeout":60000,"x":790,"y":800,"wires":[["6b650d75.ad6a54"]]},{"id":"1e6d1c31.1e6cf4","type":"change","z":"627ba918.fbd268","name":"","rules":[{"t":"set","p":"paths[\"creators\"]","pt":"msg","to":"payload.creators","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":510,"y":840,"wires":[["f8ae5763.309b88"]]},{"id":"269eb26b.f6f0ae","type":"change","z":"627ba918.fbd268","name":"","rules":[{"t":"set","p":"paths[\"titles\"]","pt":"msg","to":"payload.titles","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":500,"y":900,"wires":[["f8ae5763.309b88"]]},{"id":"cdb9c429.6e4b28","type":"debug","z":"627ba918.fbd268","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":770,"y":940,"wires":[]},{"id":"280ee349.02119c","type":"change","z":"627ba918.fbd268","name":"Get Paths","rules":[{"t":"set","p":"payload","pt":"msg","to":"paths","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":780,"y":880,"wires":[["e3b05615.e59528"]]},{"id":"e3b05615.e59528","type":"change","z":"627ba918.fbd268","name":"Get Config Properties","rules":[{"t":"set","p":"config","pt":"msg","to":"config","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":980,"y":880,"wires":[["cdb9c429.6e4b28"]]},{"id":"6b650d75.ad6a54","type":"change","z":"627ba918.fbd268","name":"","rules":[{"t":"set","p":"in_work","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":980,"y":800,"wires":[["280ee349.02119c"]]},{"id":"e23181ef.db8aa","type":"change","z":"627ba918.fbd268","name":"","rules":[{"t":"set","p":"paths[\"in_work\"]","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":510,"y":780,"wires":[["f8ae5763.309b88"]]}]